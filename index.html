<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Sets LEGO Amazon Tracker</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    h1 {
      text-align: center;
    }
    table {
      width: 100%;
    }
    a.btn {
      background: #ff9900;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      text-decoration: none;
      font-size: 0.9em;
    }
    a.btn:hover {
      background: #e68a00;
    }
  </style>
</head>
<body>
  <h1>Suivi des sets LEGO Amazon (en stock)</h1>
  <table id="legoTable" class="display"></table>

  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <script>
    Papa.parse("lego_afol_filtered.csv", {
      download: true,
      header: true,
      complete: function(results) {
        let data = results.data.filter(row => row["set_number"]);
        let columns = Object.keys(data[0]).map(k => {
          if (k === "url") {
            return {
              title: "Lien Amazon",
              data: "url",
              render: function(url) {
                if (!url) return "";
                return `<a href="${url}" target="_blank" class="btn">Voir</a>`;
              }
            };
          } else {
            return { title: k, data: k };
          }
        });
        $('#legoTable').DataTable({
          data: data,
          columns: columns,
          pageLength: 15,
          order: [[0, 'asc']],
        });
      }
    });
  </script>
</body>
</html>
